{"ast":null,"code":"import { useState } from \"react\";\nimport { ethers } from \"ethers\";\nimport Greeter from \"../artifacts/contracts/hotelManagement.sol/hotelManagement.json\";\nimport constants from '../utils/constants.json';\nconst contractAddress = constants.key;\nexport async function requestAccount() {\n  await window.ethereum.request({\n    method: \"eth_requestAccounts\"\n  });\n}\nconst provider = new ethers.providers.Web3Provider(window.ethereum);\nconst signer = provider.getSigner();\nconst contract = new ethers.Contract(contractAddress, Greeter.abi, signer);\nexport async function createPayment(userId, payment, rooms) {\n  try {\n    await requestAccount();\n    const currentNonce = await signer.getTransactionCount();\n    const transaction = await contract.createPayment(userId, payment, rooms, {\n      nonce: 2\n    });\n    const transactionReceipt = await transaction.wait();\n\n    if (transactionReceipt.status === 1) {\n      console.log(transactionReceipt);\n      const filter = contract.filters.PaymentCreated(null);\n      const events = await contract.queryFilter(filter, transactionReceipt.blockHash);\n      const result = events[0].args[0];\n      console.log(result);\n      return result;\n    } else {\n      console.log(\"Transaction failed.\");\n    }\n  } catch (error) {\n    console.log(\"Error: \", error);\n  }\n}\nexport async function getPermissions() {\n  try {\n    await requestAccount();\n    console.log(\"Hello\");\n    const transaction = await contract.getPermissions();\n    console.log(transaction.length);\n    return transaction;\n  } catch (error) {\n    console.log(\"Error: \", error);\n  }\n}\nexport async function checkoutRooms(paymentID, rooms) {\n  try {\n    await requestAccount();\n    console.log(\"Hello\");\n    const transaction = await contract.checkoutRooms(paymentID, rooms);\n    console.log(transaction.length);\n    const filter = contract.filters.RoomsCheckedOut(null);\n    const events = await contract.queryFilter(filter, transaction.blockHash);\n    const result = events[0].args[0];\n    await setTimeout(3000);\n    return result;\n  } catch (error) {\n    console.log(\"Error: \", error);\n  }\n}\nexport async function approvePayment(Id) {\n  console.log(Id);\n\n  try {\n    await requestAccount();\n    console.log(\"Hello\");\n    console.log(contract);\n    console.log(await signer.getAddress());\n    const transaction = await contract.approvePayment(Id);\n    console.log(transaction);\n    const filter = contract.filters.PaymentApproved(null, null);\n    const events = await contract.queryFilter(filter, transaction.blockHash);\n    console.log(events[0].args);\n    const result = events[0].args[0];\n    console.log(result);\n    return result;\n  } catch (error) {\n    console.log(\"Error: \", error);\n  }\n}","map":{"version":3,"sources":["/Users/macbook/Desktop/Projects/Hotel-management-Mern-stack-/client/hotel/src/utils/smartContract.js"],"names":["useState","ethers","Greeter","constants","contractAddress","key","requestAccount","window","ethereum","request","method","provider","providers","Web3Provider","signer","getSigner","contract","Contract","abi","createPayment","userId","payment","rooms","currentNonce","getTransactionCount","transaction","nonce","transactionReceipt","wait","status","console","log","filter","filters","PaymentCreated","events","queryFilter","blockHash","result","args","error","getPermissions","length","checkoutRooms","paymentID","RoomsCheckedOut","setTimeout","approvePayment","Id","getAddress","PaymentApproved"],"mappings":"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","sourcesContent":["import { useState } from \"react\";\nimport { ethers } from \"ethers\";\nimport Greeter from \"../artifacts/contracts/hotelManagement.sol/hotelManagement.json\";\nimport constants from '../utils/constants.json'\nconst contractAddress = constants.key\nexport async function requestAccount() {\n  await window.ethereum.request({ method: \"eth_requestAccounts\" });\n}\nconst provider = new ethers.providers.Web3Provider(window.ethereum);\nconst signer = provider.getSigner();\nconst contract = new ethers.Contract(contractAddress, Greeter.abi, signer);\nexport async function createPayment(userId, payment, rooms) {\n  try {\n    await requestAccount();\n\n    const currentNonce = await signer.getTransactionCount();\n    const transaction = await contract.createPayment(userId, payment, rooms, {\n      nonce:2,\n    });\n    const transactionReceipt = await transaction.wait();\n    if (transactionReceipt.status === 1) {\n      console.log(transactionReceipt);\n      const filter = contract.filters.PaymentCreated(null);\n      const events = await contract.queryFilter(filter, transactionReceipt.blockHash);\n      const result = events[0].args[0];\n      console.log(result);\n      return result;\n    } else {\n      console.log(\"Transaction failed.\");\n    }\n  } catch (error) {\n    console.log(\"Error: \", error);\n  }\n}\n\nexport async function getPermissions() {\n  try {\n    await requestAccount();\n    console.log(\"Hello\");\n\n    const transaction = await contract.getPermissions();\n    console.log(transaction.length);\n    return transaction\n  } catch (error) {\n    console.log(\"Error: \", error);\n  }\n}\n  export async function checkoutRooms(paymentID,rooms) {\n    try {\n      await requestAccount();\n      console.log(\"Hello\");\n  \n      const transaction = await contract.checkoutRooms(paymentID,rooms);\n      console.log(transaction.length);\n      const filter = contract.filters.RoomsCheckedOut(null);\n      const events = await contract.queryFilter(filter,  transaction.blockHash);\n      const result = events[0].args[0];\n      await setTimeout(3000)\n      return result;\n    } catch (error) {\n      console.log(\"Error: \", error);\n    }\n    \n}\nexport async function approvePayment(Id) {\n  console.log(Id)\n  try {\n    await requestAccount();\n    console.log(\"Hello\");\n    console.log(contract)\n    console.log( await signer.getAddress())\n    const transaction = await contract.approvePayment(Id);\n    console.log(transaction);\n    const filter = contract.filters.PaymentApproved(null,null);\n    const events = await contract.queryFilter(filter,  transaction.blockHash);\n    console.log(events[0].args)\n    const result = events[0].args[0];\n    console.log(result)\n    return result;\n  } catch (error) {\n    console.log(\"Error: \", error);\n  }\n  \n}\n"]},"metadata":{},"sourceType":"module"}